import streamlit as st
import time

# ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
st.set_page_config(page_title="ูููุฉ ููุฏ-ูุงุชุดุฑ ุงูุฃุณุทูุฑูุฉ", page_icon="๐ต๏ธโโ๏ธ", layout="centered")

# ุงูุชูุณูู ุงูุจุตุฑู (ุณุชุงูู ุงููุงูุฑุฒ ุงููุชูุฏู)
st.markdown("""
    <style>
    .stApp { background-color: #000000; }
    h1, h2, h3, p, label, .stMarkdown { color: #00FF41 !important; font-family: 'Courier New', monospace; }
    .stButton > button { width: 100%; background-color: transparent; color: #00FF41; border: 2px solid #00FF41; border-radius: 15px; height: 3.5em; font-size: 18px; transition: 0.3s; }
    .stButton > button:hover { background-color: #00FF41; color: black; box-shadow: 0 0 25px #00FF41; }
    .story-box { padding: 25px; border-left: 5px solid #00FF41; background-color: #0d0d0d; margin-bottom: 20px; font-size: 18px; line-height: 1.8; }
    .warning-text { color: #ff0000 !important; font-weight: bold; animation: blinker 1.5s linear infinite; }
    @keyframes blinker { 50% { opacity: 0; } }
    </style>
    """, unsafe_allow_html=True)

# ุฅุฏุงุฑุฉ ูุฑุงุญู ุงููุนุจุฉ
if 'step' not in st.session_state: st.session_state.step = "welcome"
if 'score' not in st.session_state: st.session_state.score = 0

# --- ุงููุฑุญูุฉ 1: ุงูุชุฑุญูุจ ---
if st.session_state.step == "welcome":
    st.markdown("<h1 style='text-align: center;'>โ๏ธ ุนุงูู ููุฏ-ูุงุชุดุฑ: ุงููุถุงุก ุงูุฑููู</h1>", unsafe_allow_html=True)
    st.image("https://r2.erweima.ai/i/6DAnC4M_S2m4_wS_Y1A5pA.png", width=350)
    st.write("ุฃููุงู ุจูู ูู ุฃุฎุทุฑ ูููุฉ ุฃูููุฉ.. ุงูุนุงูู ุงูุฑููู ูููุงุฑ ูุงูุญู ุจูู ูุฏููู.")
    
    name = st.text_input("ุฃุฏุฎู ุงุณูู ุฃููุง ุงููุญูู ุงูุฑููู (ุงููููุฐ):", key="p_name_input")
    if st.button("๐ ุฏุฎูู ุนุงูู ููุฏ-ูุงุชุดุฑ"):
        if name:
            st.session_state.p_name = name
            st.session_state.step = "story_long"
            st.rerun()
        else:
            st.error("ุงูุงุณู ูุทููุจ ููุชุญ ุงูุณุฌู ุงูุฃููู!")

# --- ุงููุฑุญูุฉ 2: ุงููุตุฉ ุงูุทูููุฉ ูููุณููู ุงููุถุงุก ---
elif st.session_state.step == "story_long":
    st.markdown(f"<h3>๐จ ููู ุงููุถูุฉ ุฑูู 707 - ุงููุญูู {st.session_state.p_name}</h3>", unsafe_allow_html=True)
    
    # ูุดุบู ุงูููุณููู (ููุณููู ูุณูุณู ุงููุถุงุก)
    st.write("๐ต **ุดุบูู ููุณููู ุงููุถุงุก ูุชุนูุดู ุฃุฌูุงุก ุงูุชุญููู:**")
    st.audio("https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Yargi+Main+Theme&filename=mt/mtyzodm3nzm2mtyzody5_vj_2bl_2bjv_2bq2u.mp3")

    st.markdown(f"""
    <div class="story-box">
    ูู ุชูุงู ุงูุณุงุนุฉ 2:45 ุตุจุงุญุงูุ ุงูุทููุช ุตุงูุฑุงุช ุงูุฅูุฐุงุฑ ูู "ุณูุฑูุฑ ุงููุฏุฑุณุฉ ุงููุฑูุฒู". 
    ุดุฎุต ูุฌููู ูููุจ ููุณู ุจู <b>"ุงูุธู ุงูุฃุณูุฏ"</b> ุชููู ูู ุชุฌุงูุฒ ุฌุฏุฑุงู ุงูุญูุงูุฉ. 
    ูู ููุชูู ุจุชุบููุฑ ุงูุฏุฑุฌุงุชุ ุจู ูุงู ุจููู ูููุงุช "ูุชุงุฆุฌ ุงูุชุฎุฑุฌ" ูุทูุจ ูุฏูุฉ ุถุฎูุฉ! <br><br>
    ูุงููุฑุงุช ุงููุฑุงูุจุฉ ุงูุฑูููุฉ ุณุฌูุช ุฏุฎููุงู ูู ุนููุงู IP ูุฌูููุ ูุงูุดููู ุชุฏูุฑ ุญูู 3 ุฃุดุฎุงุต.. 
    ููู ุงูุฃูู ุงูุขู ููุณ ูู ุงููุงุนูุ ุจู ููู ุฃููู ุนุฏุงุฏ ุงูุชุฏููุฑ ุงูุฐุงุชู ุงูุฐู ููุชูู ุจุนุฏ 5 ุฏูุงุฆู!<br><br>
    <span class="warning-text">โ๏ธ ุชูุจูู: ุงููุธุงู ุณูููุงุฑ ุชูุงูุงู ุฅุฐุง ูู ูุชู ุชุทููุฑ ุงูุซุบุฑุงุช ุงูุณุชุฉ ููุฑุงู!</span>
    </div>
    """, unsafe_allow_html=True)
    
    if st.button("โ๏ธ ุจุฏุก ุฌูุณุฉ ุงููุถุงุก ุงูุณูุจุฑุงูู"):
        st.session_state.step = "battle_zone"
        st.rerun()

# --- ุงููุฑุญูุฉ 3: ุงูุฃุณุฆูุฉ ุงูุณุชุฉ (ุงููุนุฑูุฉ) ---
elif st.session_state.step == "battle_zone":
    st.markdown(f"<h3>๐๏ธ ุชุทููุฑ ุงููุธุงู - ูุญุงููุฉ ุงูุฅููุงุฐ</h3>", unsafe_allow_html=True)
    st.write(f"ุงููุญูู: {st.session_state.p_name} | ุงูููุช ุงููุชุจูู: **04:59** โณ")
    
    with st.expander("๐ก๏ธ ุงูุชุญุฏู 1: ุฑุณุงูุฉ ุงูุฅูููู ุงูููุฎุฎุฉ", expanded=True):
        q1 = st.radio("ูุตู ุฅูููู ูููุฏูุฑุฉ ูููู 'ูุงุชูุฑุฉ ุงููุฏุฑุณุฉ ูุชุฃุฎุฑุฉุ ุงุถุบุท ููุชุญููู'. ุงูุฅูููู ูู (admin@school-results-secure.xyz). ูู ูู ุขููุ", ["ูุนูุ ูุจุฏู ุฑุณููุงู", "ูุงุ ูุฐุง ุฅูููู ุชุตูุฏ (Phishing)", "ุณุฃูุชุญู ูู ุฌูุงูู ููุท"])
    
    with st.expander("๐ก๏ธ ุงูุชุญุฏู 2: ุดููุฑุฉ ุงูุฏุฎูู"):
        q2 = st.radio("ุงููุงูุฑ ูุณุฑ ูููุฉ ูุฑูุฑ ุงูุณูุฑูุฑ ูุฃููุง ูุงูุช '123456'. ุฃู ูุงุญุฏุฉ ูู ุงูุญุตู ุงููููุนุ", ["School@2025_Success!", "MyNameIsJouri", "Admin_Pass_123"])

    with st.expander("๐ก๏ธ ุงูุชุญุฏู 3: ุงูููุงุด ููููุฑู ุงูุบุงูุถ"):
        q3 = st.radio("ูุฌุฏุชู ููุงุด ููููุฑู ุนููู ุดุนุงุฑ 'ุฏุฑุฌุงุช ุงูุทูุงุจ' ูุฑูู ูู ุงูุณุงุญุฉ. ูุงุฐุง ุชูุนูููุ", ["ุฃุฌุฑุจู ุนูู ููุจููุชุฑ ุงููุฏุฑุณุฉ", "ุฃุนุทูู ูููุฏูุฑุฉ ููุฑุงู ุฏูู ูุชุญู", "ุฃูุชุญู ูุฃูุณุญ ุงูููุฑูุณุงุช ุจููุณู"])

    with st.expander("๐ก๏ธ ุงูุชุญุฏู 4: ุฑูุงุจุท ุงููุงุชุณุงุจ"):
        q4 = st.radio("ูุตูุช ุฑุณุงูุฉ ูู ุฌุฑูุจ ุงููุฏุฑุณุฉ: 'ุชุนุฏูู ุงูุฏุฑุฌุงุช ูุชุงุญ ุงูุขู ุนุจุฑ ูุฐุง ุงูุฑุงุจุท: http://check-grades.net'.", ["ุฑุงุจุท ุงุญุชูุงูู ูุงุถุญ", "ุฑุงุจุท ุณุฑูุน ููููุฏ", "ุฑุงุจุท ุชุญุฏูุซ ูููุธุงู"])

    with st.expander("๐ก๏ธ ุงูุชุญุฏู 5: ุฌุฏุงุฑ ุงูุญูุงูุฉ (Firewall)"):
        q5 = st.radio("ุฃูุถู ุทุฑููุฉ ูููุน ุงููุงูุฑ ูู ุงูุนูุฏุฉ ูุฑุฉ ุฃุฎุฑู ูู:", ["ุชูุนูู ุงูุชุญูู ุจุฎุทูุชูู (2FA)", "ุฅุฎูุงุก ุงูููุจููุชุฑ ูู ุงูุฎุฒุงูุฉ", "ุชุบููุฑ ุฎูููุฉ ุงูุดุงุดุฉ"])

    with st.expander("๐ก๏ธ ุงูุชุญุฏู 6: ุงูููุงุฌูุฉ ุงูููุงุฆูุฉ"):
        q6 = st.radio("ุงููุงูุฑ ูุญุงูู ุงูุขู ูุณุญ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ. ุงูุฅุฌุฑุงุก ุงูููุฑู ูู:", ["ูุตู ุงูุณูุฑูุฑ ุนู ุงูุดุจูุฉ (Isolation)", "ุงูุงุชุตุงู ุจุงูุดุฑุทุฉ", "ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุงุฒ"])

    if st.button("โ๏ธ ุฅุตุฏุงุฑ ุงูุญูู ุงูููุงุฆู"):
        # ุงูุชุญูู ูู ุงูุฅุฌุงุจุงุช (ุงูุฎูุงุฑ ุงูุซุงูู ุฏุงุฆูุงู ูู ุงูุตุญูุญ ููุง ููุชุจุณูุท)
        correct_answers = [
            q1 == "ูุงุ ูุฐุง ุฅูููู ุชุตูุฏ (Phishing)",
            q2 == "School@2025_Success!",
            q3 == "ุฃุนุทูู ูููุฏูุฑุฉ ููุฑุงู ุฏูู ูุชุญู",
            q4 == "ุฑุงุจุท ุงุญุชูุงูู ูุงุถุญ",
            q5 == "ุชูุนูู ุงูุชุญูู ุจุฎุทูุชูู (2FA)",
            q6 == "ูุตู ุงูุณูุฑูุฑ ุนู ุงูุดุจูุฉ (Isolation)"
        ]
        st.session_state.score = sum(correct_answers)
        st.session_state.step = "final_verdict"
        st.rerun()

# --- ุงููุฑุญูุฉ 4: ุงูุญูู ูุงูุชูููู ---
elif st.session_state.step == "final_verdict":
    st.markdown(f"<h1>โ๏ธ ุญูู ุงููุถุงุก ุงูุณูุจุฑุงูู</h1>", unsafe_allow_html=True)
    if st.session_state.score >= 5:
        st.balloons()
        st.success(f"ููุฏ ูุนูุชูุง ูุง {st.session_state.p_name}! ุชู ุฏุญุฑ 'ุงูุธู ุงูุฃุณูุฏ' ูุงุณุชุนุงุฏุฉ ุงูุฏุฑุฌุงุช.")
    else:
        st.error(f"ููุฃุณู ูุง {st.session_state.p_name}ุ ุงููุงูุฑ ูุงู ุฃุณุฑุน ููู. ุงููุธุงู ุชุฏูุฑ ุฌุฒุฆูุงู.")

    st.write(f"ููุงุท ุงูุญูุงูุฉ ุงูุชู ุญููุชูุง: **{st.session_state.score} ูู 6**")
    
    st.write("---")
    st.subheader("โ๏ธ ุจุตูุชูู ุงููุญููุฉ ุงูุฌูุฑูุ ูุง ูู ุชูุตูุงุชูู ุงูุฃูููุฉุ")
    advice = st.text_area("ุงูุชุจู ูุตูุญุชู ููุทูุงุจ ููุง:", placeholder="ูุซูุงู: ูุง ุชุถุนูุง ูููุงุช ูุฑูุฑ ุณููุฉ..")
    
    if st.button("ุฎุชู ุงููุถูุฉ ๐"):
        st.info("ูุธุงู ููุฏ-ูุงุชุดุฑ ูููู ุจุชุญููู ูุตูุญุชู ุงูุขู...")
        time.sleep(2)
        st.success(f"ูุตูุญุฉ ุฐูุจูุฉ! ุชู ุงุนุชูุงุฏูุง ูู ุณุฌูุงุช ุงููุฏุฑุณุฉ.")
        st.markdown(f"<br><center>ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ ุงููุจุฏุนุฉ: <b>ุงูุฌูุฑู</b> โจ</center>", unsafe_allow_html=True)
        if st.button("ุจุฏุก ุชุญููู ุฌุฏูุฏ ๐"):
            st.session_state.clear()
            st.rerun()
